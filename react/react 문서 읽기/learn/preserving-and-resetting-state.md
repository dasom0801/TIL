# Preserving and Resetting State

https://react.dev/learn/preserving-and-resetting-state

상태는 컴포넌트 간에 격리된다. React는 UI 트리에서 어떤 컴포넌트가 어떤 상태에 속하는지를 추적한다. 언제 상태를 보존할지, 언제 다시 렌더링할지 제어할 수 있다.

## 상태는 렌더링 트리의 위치에 연결된다.

- React는 UI의 컴포넌트 구조에 대한 렌더 트리를 빌드한다.
- 컴포넌트에 state를 부여하면, state가 컴포넌트 내부에 존재하지 않는다. state는 실제로 React 내부에 보관된다. React는 렌더 트리에서 해당 컴포넌트 위치에 따라 보유하고 있는 각 state를 올바른 컴포넌트와 연결한다.
- React에서 화면의 각 컴포넌트는 완전히 독립된 상태를 갖는다. 서로에게 영향을 미치지 않는다.
- React는 트리의 같은 위치에 같은 컴포넌트를 렌더링하는 한 상태를 유지한다.
- React는 컴포넌트가 UI 트리에서 해당 위치에 렌더링되는 동안에 컴포넌트의 상태를 유지한다.
- 컴포넌트가 제거되거나 같은 위치에 다른 컴포넌트가 렌더링되면 React는 해당 컴포넌트의 상태를 삭제한다.

## 같은 위치의 같은 컴포넌트는 상태를 유지한다.

- 리액트는 리턴하는 트리만 본다. 컴포넌트 내부 분기 처리 같은 로직 구조는 상관하지 않는다.
- 트리의 같은 위치에 같은 컴포넌트가 그려지면 React의 관점에서 봤을 때 같은 컴포넌트이다.

## 같은 위치의 다른 컴포넌트는 상태를 초기화한다.

- 같은 위치에서 다른 컴포넌트로 전환하면 React는 UI 트리에서 컴포넌트를 제거하고 상태를 파괴한다.
- 같은 위치에서 다른 컴포넌트를 렌더링하면 전체 하위 트리의 상태가 재설정된다.
- 리렌더링할 때 상태를 유지하려면 트리의 구조가 렌더링 간에 트리의 구조가 일치해야 한다. 구조가 다르면 React는 트리에서 컴포넌트를 제거할 때 state를 삭제하기 때문에 state가 파괴된다.

### 컴포넌트를 중첩으로 선언하면 안 된다

- 컴포넌트 안에 컴포넌트를 선언하면 해당 컴포넌트는 모든 렌더링에서 다른 함수로 생성된다.
- 같은 위치에 다른 컴포넌트를 렌더링하기 때문에 React는 아래 모든 상태를 초기화 한다.
- 컴포넌트 함수는 최상위 레벨에서 선언해야 한다. 컴포넌트 정의를 중첩하면 안된다.

## 같은 위치에서 상태 초기화

- 기본적으로 리액트는 컴포넌트가 같은 위치에 머물면 컴포넌트의 상태를 보존한다.

### 옵션1 : 다른 위치에 컴포넌트 렌더링하기

- 컴포넌트를 독립적으로 만들려면 다른 위치에 렌더링하면 된다.
- 독립적인 컴포넌트 몇 개만 렌더링할 떄 유용한 방법

```tsx
export default function Scoreboard() {
	const [isPlayerA, setIsPlayerA] = useState(true);
	return (
		<div>
			{isPlayerA && <Counter person='Taylor' />}
			{!isPlayerA && <Counter person='Sarah' />}
			<button
				onClick={() => {
					setIsPlayerA(!isPlayerA);
				}}
			>
				Next player!
			</button>
		</div>
	);
}
```

### 옵션2: 키를 사용하여 상태 초기화하기

- 키를 사용하여 React가 모든 컴포넌트를 구별할 수 있다.
- 키를 지정하면 React는 부모 내의 순서 대신 키 자체를 위치의 일부로 사용하도록 한다.
- JSX에서 같은 위치에 렌더링하더라도 React는 다른 컴포넌트로 간주하여 상태를 공유하지 않는다.
- key는 전역적으로 고유할 필요는 없다. 부모 내에서의 위치만 지정한다.

### 제거된 컴포넌트의 상태 보존

- 컴포넌트를 트리에서 제거하는 게 아니라 CSS로 숨긴다. 트리에서 제거하지 않으면 로컬 상태가 유지된다. 단순한 UI에 적합하다. 숨겨진 트리가 크고 많은 DOM 노드를 포함하면 속도가 느려질 수 있다.
- 상태를 위로 올려서 보관할 수 있다. 하위 컴포넌트가 제거되더라도 중요한 정보를 보관하는 것은 상위 컴포넌트이기 때문에 문제가 되지 않는다. 일반적인 해결책
- React 상태 외의 다른 소스를 사용할 수 있다. 예) 로컬스토리지
